
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="../_static/logo_sq.svg" type="image/svg+xml">
    <title>NeXus data format &#8212; RosettaSciIO  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom-styles.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=d1c4098b"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'supported_formats/nexus';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CEOS Panta Rhei (PRZ)" href="pantarhei.html" />
    <link rel="prev" title="NetCDF (EELSlab) format" href="netcdf.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_rec_oct22.svg" class="logo__image only-light" alt="RosettaSciIO  documentation - Home"/>
    <img src="../_static/logo_rec_dark_oct22.svg" class="logo__image only-dark pst-js-only" alt="RosettaSciIO  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../file_specification/index.html">
    File Specifications
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Supported formats
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../changes.html">
    Release Notes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/hyperspy/rosettasciio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gitter.im/hyperspy/hyperspy" title="Gitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-gitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Gitter</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../file_specification/index.html">
    File Specifications
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Supported formats
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../changes.html">
    Release Notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/hyperspy/rosettasciio" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://gitter.im/hyperspy/hyperspy" title="Gitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-gitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Gitter</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="arina.html">Arina</a></li>
<li class="toctree-l1"><a class="reference internal" href="blockfile.html">Blockfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="bruker.html">Bruker</a></li>
<li class="toctree-l1"><a class="reference internal" href="de5.html">Direct Electron EMD (DE5)</a></li>
<li class="toctree-l1"><a class="reference internal" href="delmic.html">Delmic HDF5</a></li>
<li class="toctree-l1"><a class="reference internal" href="dens.html">DENSsolutions formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitalmicrograph.html">Gatan Digital Micrograph</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitalsurf.html">DigitalSurf format (SUR &amp; PRO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="edax.html">EDAX TEAM/Genesis (SPC, SPD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="emd.html">Electron Microscopy Dataset (EMD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="empad.html">EMPAD format (XML &amp; RAW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="hamamatsu.html">Hamamatsu</a></li>
<li class="toctree-l1"><a class="reference internal" href="hspy.html">HSpy - HyperSpy’s HDF5 Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="image.html">Image formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="jeol.html">JEOL Analyst Station (ASW, …)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jobinyvon.html">Horiba Jobin Yvon LabSpec</a></li>
<li class="toctree-l1"><a class="reference internal" href="mrc.html">MRC format</a></li>

<li class="toctree-l1"><a class="reference internal" href="mrcz.html">MRCZ format</a></li>
<li class="toctree-l1"><a class="reference internal" href="msa.html">EMSA/MSA format</a></li>
<li class="toctree-l1"><a class="reference internal" href="netcdf.html">NetCDF (EELSlab) format</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">NeXus data format</a></li>
<li class="toctree-l1"><a class="reference internal" href="pantarhei.html">CEOS Panta Rhei (PRZ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="phenom.html">Phenom ELID format</a></li>
<li class="toctree-l1"><a class="reference internal" href="protochips.html">Protochips logfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantumdetector.html">Quantum Detector</a></li>
<li class="toctree-l1"><a class="reference internal" href="renishaw.html">Renishaw</a></li>
<li class="toctree-l1"><a class="reference internal" href="ripple.html">Ripple format</a></li>
<li class="toctree-l1"><a class="reference internal" href="semper.html">SEMPER binary format (UNF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tia.html">FEI TIA (SER &amp; EMI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tiff.html">Tagged image file format (TIFF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="trivista.html">TriVista</a></li>
<li class="toctree-l1"><a class="reference internal" href="tvips.html">TVIPS format</a></li>
<li class="toctree-l1"><a class="reference internal" href="usid.html">Universal Spectroscopy and Imaging Data (h5USID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="zspy.html">ZSpy - HyperSpy’s Zarr Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="supporting_your_file_format.html">Supporting Your File Format</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Supported formats</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">NeXus data format</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="nexus-data-format">
<span id="nexus-format"></span><h1>NeXus data format<a class="headerlink" href="#nexus-data-format" title="Link to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To read this format, the optional dependency <code class="docutils literal notranslate"><span class="pre">h5py</span></code> is required.</p>
</div>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://www.nexusformat.org">NeXus</a> is a common data format originally
developed by the neutron and x-ray science x-ray communities. It is still being
developed as an international standard by scientists and programmers
representing major scientific facilities in order to facilitate greater
cooperation in the analysis and visualization of data.
NeXus uses a variety of classes to record data, values,
units and other experimental metadata associated with an experiment.
For specific types of experiments an Application Definition may exist, which
defines an agreed common layout that facilities can adhere to.</p>
<p>NeXus metadata and data are stored in Hierarchical Data Format Files (HDF5) with
a <code class="docutils literal notranslate"><span class="pre">.nxs</span></code> extension although standard HDF5 extensions are sometimes used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <a class="reference external" href="https://hyperspy.org">HyperSpy</a>, files must use the <code class="docutils literal notranslate"><span class="pre">.nxs</span></code> file
extension in order to default to the NeXus loader. If your file has
an HDF5 extension, you can also explicitly set the NeXus file reader:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load a NeXus file with a .h5 extension</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">hyperspy.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hs</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;filename.h5&quot;</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="s2">&quot;nxs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The loader will follow version 3 of the
<a class="reference external" href="https://manual.nexusformat.org/datarules.html#version-3">NeXus data rules</a>.
The signal type, Signal1D or Signal2D, will be inferred by the <code class="docutils literal notranslate"><span class="pre">interpretation</span></code>
attribute, if this is set to <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> or <code class="docutils literal notranslate"><span class="pre">image</span></code>, in the <code class="docutils literal notranslate"><span class="pre">NXdata</span></code>
description. If the <a class="reference external" href="https://manual.nexusformat.org/design.html#design-attributes">interpretation</a> attribute is
not set, the loader will return a <code class="docutils literal notranslate"><span class="pre">BaseSignal</span></code>, which must then be converted
to the appropriate signal type. Following the NeXus data rules, if a <code class="docutils literal notranslate"><span class="pre">default</span></code>
dataset is not defined, the loader will load NXdata
and HDF datasets according to the keyword options in the reader.
A number of the <a class="reference external" href="https://github.com/nexusformat/exampledata">NeXus examples</a>
from large facilties do not use NXdata or use older versions of the NeXus
implementation. Data can still be loaded from these files but information or
associations may be missing. However, this missing information can be recovered
from within the  <code class="docutils literal notranslate"><span class="pre">original_metadata</span></code> which contains the overall structure of
the entry.</p>
<p>As the NeXus format uses the HDF5 format and needs to read both data and
metadata structured in different ways, the loader is written to be quite
flexible and can also be used to inspect any hdf5 based file.</p>
</section>
<section id="differences-with-respect-to-hspy">
<h2>Differences with respect to HSpy<a class="headerlink" href="#differences-with-respect-to-hspy" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="https://hyperspy.org/hyperspy-doc/current/reference/metadata.html#metadata-structure" title="(in HyperSpy v2.3)"><span class="xref std std-ref">HyperSpy metadata structure</span></a>
stores arrays as hdf datasets without attributes
and stores floats, ints and strings as attributes.
The NeXus format uses hdf dataset attributes to store additional
information such as an indication of the units for an axis or the <code class="docutils literal notranslate"><span class="pre">NX_class</span></code> which
the dataset structure follows. The metadata, HyperSpy or <code class="docutils literal notranslate"><span class="pre">original_metadata</span></code>,
therefore needs to be able to indicate the values and attributes of a dataset.
To implement this structure the <code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">attrs</span></code> of a dataset can also be
defined. The value of a dataset is set using a <code class="docutils literal notranslate"><span class="pre">value</span></code> key.
The attributes of a dataset are defined by an <code class="docutils literal notranslate"><span class="pre">attrs</span></code> key.</p>
<p>For example, to store an array called <code class="docutils literal notranslate"><span class="pre">axis_x</span></code>, with a units attribute within
<code class="docutils literal notranslate"><span class="pre">original_metadata</span></code>, the following structure would be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├──original_metadata
│   ├── axis_x
│   │   ├── value : array([1.0,2.0,3.0,4.0,5.0])
│   │   ├── attrs
│   │   │   ├── units : mm
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">original_metadata</span><span class="o">.</span><span class="n">set_item</span><span class="p">(</span><span class="n">axis_x</span><span class="o">.</span><span class="n">value</span><span class="p">,[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">original_metadata</span><span class="o">.</span><span class="n">set_item</span><span class="p">(</span><span class="n">axis_x</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">units</span><span class="p">,</span><span class="s2">&quot;mm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To access the axis information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">original_metadata</span><span class="o">.</span><span class="n">axis_x</span><span class="o">.</span><span class="n">value</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">original_metadata</span><span class="o">.</span><span class="n">axis_x</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">units</span>
</pre></div>
</div>
<p>To modify the axis information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">original_metadata</span><span class="o">.</span><span class="n">axis_x</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">original_metadata</span><span class="o">.</span><span class="n">axis_x</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;um&quot;</span>
</pre></div>
</div>
<p>To store data in a NeXus monochromator format, <code class="docutils literal notranslate"><span class="pre">value</span></code>
and <code class="docutils literal notranslate"><span class="pre">attrs</span></code> keys can define additional attributes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── monochromator
│   ├── energy
│   │   ├── value : 12.0
│   │   ├── attrs
│   │   │   ├── units : keV
│   │   │   ├── NXclass : NXmonochromator
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">attrs</span></code> key can also be used to define NeXus structures for the definition
of structures and relationships between data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── mydata
│   ├── attrs
│   │   ├── NX_class : &quot;NXdata&quot;
│   │   ├── axes : [&quot;x&quot;,&quot;.&quot;]
│   ├── data
│   │   ├──value : [[30,23...110]
│   ├── x
│   │   ├──value : [1,2.....100]
│   │   ├── attrs
│   │   │   ├── unit : &quot;mm&quot;
</pre></div>
</div>
<p>The use of <code class="docutils literal notranslate"><span class="pre">attrs</span></code> or <code class="docutils literal notranslate"><span class="pre">value</span></code> to set values within the metadata is optional
and metadata values can also be set, read or modified in the normal way.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">original_metadata</span><span class="o">.</span><span class="n">monochromator</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="mf">12.5</span>
</pre></div>
</div>
<p>HyperSpy metadata is stored within the NeXus file and should be automatically
restored when a signal is loaded from a previously saved NeXus file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Altering the standard metadata structure of a signal
using <code class="docutils literal notranslate"><span class="pre">attrs</span></code> or <code class="docutils literal notranslate"><span class="pre">value</span></code> keywords is not recommended.</p>
</div>
<p>Also see the <a class="reference internal" href="../api/utils.html#hdf5-utils"><span class="std std-ref">HDF5 utility functions</span></a> for inspecting HDF5 files.</p>
</section>
<section id="module-rsciio.nexus">
<span id="api-functions"></span><h2>API functions<a class="headerlink" href="#module-rsciio.nexus" title="Link to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="rsciio.nexus.file_reader">
<span class="sig-prename descclassname"><span class="pre">rsciio.nexus.</span></span><span class="sig-name descname"><span class="pre">file_reader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lazy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_array_metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nxdata_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hardlinks_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rsciio.nexus.file_reader" title="Link to this definition">#</a></dt>
<dd><p>Read NXdata class or hdf datasets from a file and return signal(s).</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>filename</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a></span></dt><dd><p>Filename of the file to read or corresponding <cite>pathlib.Path</cite>.</p>
</dd>
<dt><strong>lazy</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.13)"><span class="xref std std-ref">bool</span></a>, default=False</span></dt><dd><p>Whether to open the file lazily or not. The file will stay open
until closed in <a class="reference external" href="https://hyperspy.org/hyperspy-doc/current/reference/base_classes/signal/LazySignal.html#hyperspy._signals.lazy.LazySignal.compute" title="(in HyperSpy v2.3)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compute()</span></code></a>
or closed manually. <a class="reference internal" href="../api/utils.html#rsciio.utils.tools.get_file_handle" title="rsciio.utils.tools.get_file_handle"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_file_handle()</span></code></a>
can be used to access the file handler and close it manually.</p>
</dd>
<dt><strong>dataset_key</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">None</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, default=None</span></dt><dd><p>If None all datasets are returned.
If a string or list of strings is provided only items
whose path contain the string(s) are returned. For example
dataset_key = [“instrument”, “Fe”] will return
data entries with instrument or Fe in their hdf path.</p>
</dd>
<dt><strong>dataset_path</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">None</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, default=None</span></dt><dd><p>If None, no absolute path is searched.
If a string or list of strings is provided items with the absolute
paths specified will be returned. For example, dataset_path =
[‘/data/spectrum/Mn’], it returns the exact dataset with this path.
It is not filtered by dataset_key, i.e. with dataset_key = [‘Fe’],
it still returns the specific dataset at ‘/data/spectrum/Mn’. It is
empty if no dataset matching the absolute path provided is present.</p>
</dd>
<dt><strong>metadata_key</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">None</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, default=None</span></dt><dd><p>Only return items from the original metadata whose path contain the
strings .e.g metadata_key = [“instrument”, “Fe”] will return
all metadata entries with “instrument” or “Fe” in their hdf path.</p>
</dd>
<dt><strong>skip_array_metadata</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.13)"><span class="xref std std-ref">bool</span></a>, default=False</span></dt><dd><p>Whether to skip loading metadata with an array entry. This is useful
as metadata may contain large array that is redundant with the data.</p>
</dd>
<dt><strong>nxdata_only</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.13)"><span class="xref std std-ref">bool</span></a>, default=False</span></dt><dd><p>If True only NXdata will be converted into a signal
if False NXdata and any hdf datasets will be loaded as signals.</p>
</dd>
<dt><strong>hardlinks_only</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.13)"><span class="xref std std-ref">bool</span></a>, default=False</span></dt><dd><p>If True any links (soft or External) will be ignored when loading.</p>
</dd>
<dt><strong>use_default</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.13)"><span class="xref std std-ref">bool</span></a>, default=False</span></dt><dd><p>If True and a default NXdata is defined in the file load this as a
signal. This will ignore the other keyword options. If True and no
default is defined the file will be loaded according to
the keyword options.</p>
</dd>
<dt><strong>mapping</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">None</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">dict</span></code></a></span></dt><dd><p>Define the mapping from the original metadata to the returned
metadata.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl>
<dt><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">dict</span></code></a></dt><dd><p>List of dictionaries containing the following fields:</p>
<ul class="simple">
<li><p>‘data’ – multidimensional <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> or <a class="reference external" href="https://docs.dask.org/en/latest/generated/dask.array.Array.html#dask.array.Array" title="(in Dask)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dask.array.Array</span></code></a></p></li>
<li><p>‘axes’ – list of dictionaries describing the axes
containing the fields ‘name’, ‘units’, ‘index_in_array’, and
either ‘size’, ‘offset’, and ‘scale’ or a numpy array ‘axis’
containing the full axes vector</p></li>
<li><p>‘metadata’ – dictionary containing the parsed metadata</p></li>
<li><p>‘original_metadata’ – dictionary containing the full metadata tree from the input file</p></li>
</ul>
<p>When the file contains several datasets, each dataset will be loaded as separate dictionary.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="../api/utils.html#rsciio.utils.hdf5.list_datasets_in_file" title="rsciio.utils.hdf5.list_datasets_in_file"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rsciio.utils.hdf5.list_datasets_in_file</span></code></a></dt><dd><p>Convenience function to list datasets present in a file.</p>
</dd>
<dt><a class="reference internal" href="../api/utils.html#rsciio.utils.hdf5.read_metadata_from_file" title="rsciio.utils.hdf5.read_metadata_from_file"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rsciio.utils.hdf5.read_metadata_from_file</span></code></a></dt><dd><p>Convenience function to read metadata present in a file.</p>
</dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>Loading all datasets can result in a large number of signals
Please review your datasets and use the dataset_key to target
the datasets of interest.
“keys” is a special keywords and prepended with “fix” in the metadata
structure to avoid any issues.</p>
<p>Datasets are all arrays with size&gt;2 (arrays, lists)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rsciio.nexus.file_writer">
<span class="sig-prename descclassname"><span class="pre">rsciio.nexus.</span></span><span class="sig-name descname"><span class="pre">file_writer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_original_metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_metadata_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compression</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gzip'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rsciio.nexus.file_writer" title="Link to this definition">#</a></dt>
<dd><p>Write the signal and metadata as a NeXus file.</p>
<p>This will save the signal in NXdata format in the file.
As the form of the metadata can vary and is not validated it will
be stored as an NXcollection (an unvalidated collection)</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>filename</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a></span></dt><dd><p>Filename of the file to write to or corresponding <cite>pathlib.Path</cite>.</p>
</dd>
<dt><strong>signal</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">dict</span></code></a></span></dt><dd><p>Dictionary containing the signal object.
Should contain the following fields:</p>
<ul class="simple">
<li><p>‘data’ – multidimensional numpy array</p></li>
<li><p>‘axes’ – list of dictionaries describing the axes
containing the fields ‘name’, ‘units’, ‘index_in_array’, and
either ‘size’, ‘offset’, and ‘scale’ or a numpy array ‘axis’
containing the full axes vector</p></li>
<li><p>‘metadata’ – dictionary containing the metadata tree</p></li>
</ul>
</dd>
<dt><strong>save_original_metadata</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.13)"><span class="xref std std-ref">bool</span></a> , default</span><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">True</span></code></a></span></dt><dd><p>Option to save hyperspy.original_metadata with the signal.
A loaded NeXus file may have a large amount of data
when loaded which you may wish to omit on saving.</p>
</dd>
<dt><strong>skip_metadata_key</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, default</span><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">None</span></code></a></span></dt><dd><p>The key(s) to skip when saving original metadata. This is useful
when some metadata keys should be ignored.</p>
</dd>
<dt><strong>use_default</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bltin-boolean-values" title="(in Python v3.13)"><span class="xref std std-ref">bool</span></a> , default</span><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/constants.html#False" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">False</span></code></a></span></dt><dd><p>Option to define the default dataset in the file.
If set to True the signal or first signal in the list of signals
will be defined as the default (following NeXus v3 data rules).</p>
</dd>
<dt><strong>compression</strong><span class="classifier"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">None</span></code></a>, ‘gzip’, ‘szip’, ‘lzf’, default=’gzip’</span></dt><dd><p>Compression can significantly increase the saving speed. If file size is not
an issue, it can be disabled by setting <code class="docutils literal notranslate"><span class="pre">compression=None</span></code>.
RosettaSciIO uses h5py for reading and writing HDF5 files and, therefore,
it supports all <a class="reference external" href="https://docs.h5py.org/en/stable/high/dataset.html#dataset-compression">compression filters supported by h5py</a>.
The default is <code class="docutils literal notranslate"><span class="pre">'gzip'</span></code>. Also see notes below.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="../api/utils.html#rsciio.utils.hdf5.list_datasets_in_file" title="rsciio.utils.hdf5.list_datasets_in_file"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rsciio.utils.hdf5.list_datasets_in_file</span></code></a></dt><dd><p>Convenience function to list datasets present in a file.</p>
</dd>
<dt><a class="reference internal" href="../api/utils.html#rsciio.utils.hdf5.read_metadata_from_file" title="rsciio.utils.hdf5.read_metadata_from_file"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rsciio.utils.hdf5.read_metadata_from_file</span></code></a></dt><dd><p>Convenience function to read metadata present in a file.</p>
</dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p>It is possible to enable other compression filters such as <code class="docutils literal notranslate"><span class="pre">blosc</span></code> by
installing e.g. <a class="reference external" href="https://github.com/silx-kit/hdf5plugin">hdf5plugin</a>.
Similarly, the availability of <code class="docutils literal notranslate"><span class="pre">'szip'</span></code> depends on the HDF5 installation.
If not available an error will be raised. Be aware that loading those
files will require installing the package providing the compression filter
and it may thus not be possible to load it on some platforms.
Only <code class="docutils literal notranslate"><span class="pre">compression=None</span></code> and <code class="docutils literal notranslate"><span class="pre">compression='gzip'</span></code> are available on all
platforms. For more details, see the <a class="reference external" href="https://docs.h5py.org/en/stable/faq.html#what-compression-processing-filters-are-supported">h5py documentation</a>.</p>
</dd></dl>

</section>
<section id="reading-examples">
<h2>Reading examples<a class="headerlink" href="#reading-examples" title="Link to this heading">#</a></h2>
<p>NeXus files can contain multiple datasets within the same file, but the
ordering of datasets can vary depending on the setup of an experiment or
processing step when the data was collected.
For example, in one experiment Fe, Ca, P, Pb were collected but in the next experiment
Ca, P, K, Fe, Pb were collected. RosettaSciIO supports reading in one or more datasets
and returns a list of signals but in this example case the indexing is different.
To control which data or metadata is loaded and in what order
some additional loading arguments are provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Given that HDF5 files can accommodate very large datasets, setting <code class="docutils literal notranslate"><span class="pre">lazy=True</span></code>
is strongly recommended if the content of the HDF5 file is not known apriori.
This prevents issues with regard to loading datasets far larger than memory.</p>
<p>Also note that setting <code class="docutils literal notranslate"><span class="pre">lazy=True</span></code> leaves the file handle to the HDF5 file
open. In Hyperspy, it can with <code class="docutils literal notranslate"><span class="pre">_signals.lazy.LazySignal.close_file</span></code>
or when using <code class="docutils literal notranslate"><span class="pre">_signals.lazy.LazySignal.compute</span></code> with <code class="docutils literal notranslate"><span class="pre">close_file=True</span></code>.</p>
</div>
<p>We can load a specific dataset using the <code class="docutils literal notranslate"><span class="pre">dataset_path</span></code> keyword argument.
Setting it to the absolute path of the desired dataset will cause
the single dataset to be loaded:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">rsciio.nexus</span><span class="w"> </span><span class="kn">import</span> <span class="n">file_reader</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Loading a specific dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_reader</span><span class="p">(</span><span class="s2">&quot;sample.nxs&quot;</span><span class="p">,</span> <span class="n">dataset_path</span><span class="o">=</span><span class="s2">&quot;/entry/experiment/EDS/data&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also choose to load datasets based on a search key using the
<code class="docutils literal notranslate"><span class="pre">dataset_key</span></code> keyword argument. This can also be used to load NXdata not
outside of the <code class="docutils literal notranslate"><span class="pre">default</span></code> version 3 rules. Instead of providing an absolute
path, a string can be provided as well, and datasets with this key will be
returned. The previous example could also be written as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Loading datasets containing the string &quot;EDS&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_reader</span><span class="p">(</span><span class="s2">&quot;sample.nxs&quot;</span><span class="p">,</span> <span class="n">dataset_key</span><span class="o">=</span><span class="s2">&quot;EDS&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The difference between <code class="docutils literal notranslate"><span class="pre">dataset_path</span></code> and <code class="docutils literal notranslate"><span class="pre">dataset_key</span></code> is illustrated
here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Only the dataset /entry/experiment/EDS/data will be loaded</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_reader</span><span class="p">(</span><span class="s2">&quot;sample.nxs&quot;</span><span class="p">,</span> <span class="n">dataset_path</span><span class="o">=</span><span class="s2">&quot;/entry/experiment/EDS/data&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># All datasets contain the entire string &quot;/entry/experiment/EDS/data&quot; will be loaded</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_reader</span><span class="p">(</span><span class="s2">&quot;sample.nxs&quot;</span><span class="p">,</span> <span class="n">dataset_key</span><span class="o">=</span><span class="s2">&quot;/entry/experiment/EDS/data&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Multiple datasets can be loaded by providing a number of keys:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Loading a specific dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_reader</span><span class="p">(</span><span class="s2">&quot;sample.nxs&quot;</span><span class="p">,</span> <span class="n">dataset_key</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;EDS&quot;</span><span class="p">,</span> <span class="s2">&quot;Fe&quot;</span><span class="p">,</span> <span class="s2">&quot;Ca&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Metadata can also be filtered in the same way using <code class="docutils literal notranslate"><span class="pre">metadata_key</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load data with metadata matching metadata_key</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_reader</span><span class="p">(</span><span class="s2">&quot;sample.nxs&quot;</span><span class="p">,</span> <span class="n">metadata_key</span><span class="o">=</span><span class="s2">&quot;entry/instrument&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The NeXus loader removes any NXdata blocks from the metadata.</p>
</div>
<p>Metadata that are arrays can be skipped by using <code class="docutils literal notranslate"><span class="pre">skip_array_metadata</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load data while skipping metadata that are arrays</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_reader</span><span class="p">(</span><span class="s2">&quot;sample.nxs&quot;</span><span class="p">,</span> <span class="n">skip_array_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>NeXus files also support parameters or dimensions that have been varied
non-linearly. Since the reading of non-uniform axes is not yet implemented for the
NeXus plugin, such non-linear information would be lost in the axes manager and
replaced with indices.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>NeXus and HDF can result in large metadata structures with large datasets within the loaded
original_metadata. If lazy loading is used this may not be a concern but care must be taken
when saving the data. To control whether large datasets are loaded or saved,
use the <code class="docutils literal notranslate"><span class="pre">metadata_key</span></code> to load only the most relevant information. Alternatively,
set <code class="docutils literal notranslate"><span class="pre">skip_array_metadata</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> to avoid loading those large datasets in original_metadata.</p>
</div>
</section>
<section id="writing-examples">
<h2>Writing examples<a class="headerlink" href="#writing-examples" title="Link to this heading">#</a></h2>
<p>Using the <code class="docutils literal notranslate"><span class="pre">file_writer</span></code> method will store the NeXus file with the following structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── entry1
│   ├── signal_name
│   │   ├── auxiliary
│   │   │   ├── original_metadata
│   │   │   ├── hyperspy_metadata
│   │   │   ├── learning_results
│   │   ├── signal_data
│   │   │   ├── data and axes (NXdata format)
</pre></div>
</div>
<p>To save multiple signals, the <code class="docutils literal notranslate"><span class="pre">file_writer</span></code> can be called directly passing a
list of signals.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">rsciio.nexus</span><span class="w"> </span><span class="kn">import</span> <span class="n">file_writer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_writer</span><span class="p">(</span><span class="s2">&quot;test.nxs&quot;</span><span class="p">,[</span><span class="n">signal1</span><span class="p">,</span><span class="n">signal2</span><span class="p">])</span>
</pre></div>
</div>
<p>When saving multiple signals, a default signal can be defined. This can be used when storing
associated data or processing steps along with a final result. All signals can be saved but
a single signal can be marked as the default for easier loading using RosettaSciIO
or plotting with NeXus tools.
The default signal is selected as the first signal in the list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">rsciio.nexus</span><span class="w"> </span><span class="kn">import</span> <span class="n">file_writer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_writer</span><span class="p">(</span><span class="s2">&quot;test.nxs&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">signal1</span><span class="p">,</span> <span class="n">signal2</span><span class="p">],</span> <span class="n">use_default</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The output will be arranged by signal name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── entry1 (NXentry)
│   ├── signal_name (NXentry)
│   │   ├── auxiliary (NXentry)
│   │   │   ├── original_metadata (NXcollection)
│   │   │   ├── hyperspy_metadata (NXcollection)
│   │   │   ├── learning_results  (NXcollection)
│   │   ├── signal_data (NXdata format)
│   │   │   ├── data and axes
├── entry2 (NXentry)
│   ├── signal_name (NXentry)
│   │   ├── auxiliary (NXentry)
│   │   │   ├── original_metadata (NXcollection)
│   │   │   ├── hyperspy_metadata (NXcollection)
│   │   │   ├── learning_results (NXcollection)
│   │   ├── signal_data (NXdata)
│   │   │   ├── data and axes
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Signals saved as <code class="docutils literal notranslate"><span class="pre">.nxs</span></code> by this plugin can be loaded normally in HyperSpy
and the original_metadata, signal data, axes, metadata and learning_results
will be restored. Model information is not currently stored.
NeXus does not store how the data should be displayed.
To preserve the signal details an additional navigation attribute
is added to each axis to indicate if it is a navigation axis.</p>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="netcdf.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">NetCDF (EELSlab) format</p>
      </div>
    </a>
    <a class="right-next"
       href="pantarhei.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CEOS Panta Rhei (PRZ)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-with-respect-to-hspy">Differences with respect to HSpy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-rsciio.nexus">API functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rsciio.nexus.file_reader"><code class="docutils literal notranslate"><span class="pre">file_reader()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rsciio.nexus.file_writer"><code class="docutils literal notranslate"><span class="pre">file_writer()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-examples">Reading examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-examples">Writing examples</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/supported_formats/nexus.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2023-2025, HyperSpy Developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>